name: Build pkgdown site

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      # 1️⃣ Checkout repository
      - name: Checkout repo
        uses: actions/checkout@v3

      # 2️⃣ Setup R
      - name: Setup R
        uses: r-lib/actions/setup-r@v2
        with:
          r-version: '4.3'

      # 3️⃣ Install system dependencies (optional, if needed)
      - name: Install system dependencies
        run: sudo apt-get update && sudo apt-get install -y libcurl4-openssl-dev libssl-dev libxml2-dev

      # 4️⃣ Install CRAN packages
      - name: Install CRAN packages
        run: |
          R -e 'install.packages(c("devtools","remotes","pkgdown","sessioninfo","rcmdcheck"))'

      # 5️⃣ Install Bioconductor packages
      - name: Install Bioconductor packages
        run: |
          R -e 'if (!requireNamespace("BiocManager", quietly = TRUE)) install.packages("BiocManager")'
          R -e 'BiocManager::install(c("SummarizedExperiment","GenomicRanges"))'

      # 6️⃣ Install GitHub-only packages
      - name: Install GitHub packages
        run: |
          R -e 'devtools::install_github("TriticeaeToolbox/BrAPI.R")'

      # 7️⃣ Run R CMD check
      - name: Run R CMD check
        run: |
          R -e 'devtools::check(args = c("--as-cran"))'

      # 8️⃣ Build pkgdown site
      - name: Build pkgdown site
        run: |
          R -e 'pkgdown::build_site()'

      # 9️⃣ Display session info (optional)
      - name: Session info
        run: |
          R -e 'sessioninfo::session_info()'
